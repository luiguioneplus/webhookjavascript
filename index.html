<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hola</title>

</head>
<body>
 <h1>welcome</h1>
 <div id="scrapper-status" style="margin-top:20px; font-size:1.2em;"></div>
 <button onclick="consultarEstadoScrapper()">Consultar estado del scrapper</button>
 <pre id="datos-webhook"></pre>

 <!-- Modal -->
 <div id="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5);">
   <div style="background:#fff; padding:30px 20px; border-radius:8px; max-width:350px; margin:120px auto; box-shadow:0 2px 10px #0003; text-align:center; position:relative;">
     <span id="modal-close" style="position:absolute; right:10px; top:10px; cursor:pointer; font-size:1.5em;">&times;</span>
     <div id="modal-content"></div>
   </div>
 </div>

 <script>
document.addEventListener('DOMContentLoaded', () => {
    // 1. Obtener los par√°metros de la URL
    const params = new URLSearchParams(window.location.search);
    
    // 2. Obtener la cadena de datos codificados
    const datosCodificados = params.get('data');

    let datosWebhook = {};
    if (datosCodificados) {
        try {
            // 3. Decodificar la cadena para revertir encodeURIComponent
            const datosDecodificados = decodeURIComponent(datosCodificados);
            
            // 4. Parsear la cadena JSON de vuelta a un objeto JavaScript
            datosWebhook = JSON.parse(datosDecodificados);

            console.log("Datos recibidos y listos para mostrar:", datosWebhook);

            // 5. Mostrar los datos en el DOM
            document.getElementById('datos-webhook').textContent = 
                JSON.stringify(datosWebhook, null, 2); // Muestra el JSON formateado

        } catch (e) {
            console.error("Error al decodificar o parsear los datos:", e);
            document.getElementById('datos-webhook').textContent = "Error al cargar los datos.";
        }
    } else {
        document.getElementById('datos-webhook').textContent = "Esperando datos del webhook...";
    }
});
//function showModal(message, color) {
//    document.getElementById('modal-content').innerHTML = message;
//    document.getElementById('modal-content').style.color = color;
//    document.getElementById('modal').style.display = 'block';
//}
//document.getElementById('modal-close').onclick = function() {
//    document.getElementById('modal').style.display = 'none';
//}

//function consultarEstadoScrapper() {
//    fetch('http://localhost:8080/webhook/scrapper_status') 
//        // Ya no es necesario llamar a .json() si se usa 'no-cors'
//        // pero la respuesta de 'no-cors' ser√° opaca, lo que hace dif√≠cil 
//        // procesar los datos de 'status' y 'mensaje' como se hace a continuaci√≥n.
//        // Si el objetivo es solo verificar que el endpoint est√° vivo, funciona.
//        // Si quieres el cuerpo JSON, DEBES configurar CORS en el servidor.
//        
//        // Mantengo el .then(response => response.json()) para mantener la l√≥gica de procesamiento de datos
//        // asumiendo que el *objetivo final* es que el servidor soporte CORS.
//        .then(response => response.json())
//        .then(data => {
//            let div = document.getElementById('scrapper-status');
//            // üí° Unificamos la obtenci√≥n del mensaje
//            let statusMessage = data.mensaje || data.message || 'No hay mensaje de estado disponible.'; 
//            
//            let color = 'orange';
//            let icon = '‚ö†Ô∏è';
//            
//            if (data.status === 'success') {   
//                div.innerHTML = '‚úÖ ' + statusMessage + ' ' + (data.infinite || data.data?.infinite || '');
//                color = 'green';
//                icon = '‚úÖ';
//            } else if (data.status === 'error') {
//                // Se agrega statusMessage que faltaba en tu c√≥digo de ejemplo
//                div.innerHTML = '‚ùå ' + statusMessage; 
//                color = 'red';
//                icon = '‚ùå';
//            } else {
//                div.innerHTML = icon + ' ' + statusMessage;
//            }
//            
//            showModal(icon + ' Status: <b>' + data.status + '</b><br>' + statusMessage, color);
//        })
//        .catch(err => {
//            let div = document.getElementById('scrapper-status');
//            div.innerHTML = 'Error al consultar el estado. (Puede ser CORS o Servidor apagado)';
//            div.style.color = 'gray';
//            showModal('Error al consultar el estado. (Revisa consola y servidor)', 'gray');
//        });
//}
// Consultar autom√°ticamente al cargar la p√°gina
 //window.onload = consultarEstadoScrapper;
</script>
</body>
</html>